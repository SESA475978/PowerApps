name: Backup Error
#Export Solution from DEV environment, Branch the exported solution, Export it to PRE-PRODUCTION

on:
  workflow_dispatch:
       

jobs:
  Check-Connection:
    runs-on: windows-latest
    env:
      RUNNER_DEBUG: 1
          
    steps:
    - uses: actions/checkout@v2
      with:
        lfs: true
   
    - name: Connecting to Contoso  
      uses: microsoft/powerplatform-actions/who-am-i@v0
      with:
        environment-url: https://org8afc7726.crm.dynamics.com/
        app-id: 41098e32-fccf-4145-b353-f40f2a917b16
        client-secret: CEe5HsWm7Rcr2sCQ3puQ87aZty4kE5Iq
        tenant-id: c1d0b961-f301-4256-b2ec-6e9efa04d80b
        
    - name: Backup ${{env.SOURCE_ENV_NAME}} Environment
      uses: microsoft/powerplatform-actions/backup-environment@v0.7.1
      with:
        environment-url: ${{env.SOURCE_ENV_URL}}
        app-id: ${{ secrets.APPID }}
        client-secret: ${{ secrets.CLIENT_SECRET }}
        tenant-id: ${{ secrets.TENANT_ID }}
        backup-label: Backup_before_deploy_GitAction
        notes: Git_testing
